<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Pokédex</title>

        <link
            rel="icon"
            type="image/png"
            href="favicon/android-chrome-512x512.png"
        />

        <meta property="og:type" content="website" />
        <meta property="og:title" content="Pokédex" />
        <meta property="description" content="포켓몬 도감번호로 검색해보세요!">
        <meta property="og:image" content="pokeball.png">

        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
            rel="stylesheet"
        />

        <style>
            /* 폰트 및 색상 변수 정의 */
            :root {
                --font-pixel: "Press Start 2P", cursive;
                --font-main: "Taenada", sans-serif; /* 기존 폰트도 유지 */
                --color-primary: #e63946; /* 포켓몬 레드를 메인 컬러로 */
                --color-primary-dark: #d62828;
                --color-background: #f1faee;
                --color-card: rgba(255, 255, 255, 0.7); /* 반투명 카드 배경 */
                --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            }

            /* 타입별 색상 변수 */
            :root {
                --type-normal: #a8a77a;
                --type-fire: #ee8130;
                --type-water: #6390f0;
                --type-electric: #f7d02c;
                --type-grass: #7ac74c;
                --type-ice: #96d9d6;
                --type-fighting: #c22e28;
                --type-poison: #a33ea1;
                --type-ground: #e2bf65;
                --type-flying: #a98ff3;
                --type-psychic: #f95587;
                --type-bug: #a6b91a;
                --type-rock: #b6a136;
                --type-ghost: #735797;
                --type-dragon: #6f35fc;
                --type-dark: #705746;
                --type-steel: #b7b7ce;
                --type-fairy: #d685ad;
            }

            /* 폰트 정의 */
            @font-face {
                font-family: "Taenada";
                src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2210-2@1.0/Tenada.woff2")
                    format("woff2");
                font-weight: normal;
                font-style: normal;
                font-display: swap;
            }

            body {
                font-family: var(--font-main);
                background: linear-gradient(
                    135deg,
                    #a8d5e2 0%,
                    #f7d5d5 100%
                ); /* 그라데이션 배경 */
                text-align: center;
                padding: 20px;
                margin: 0;
                min-height: 100vh;
            }

            /* --- 🎨 시작 화면 스타일 --- */
            #startScreen {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: #f1faee;
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                transition: opacity 0.7s ease-out; /* 사라지는 효과 */
            }
            #startScreen.hidden {
                opacity: 0;
            }
            #pokeball {
                width: 100px;
                animation: bounce 1.5s infinite; /* 바운스 애니메이션 적용 */
            }

            /* --- 통통 튀는 애니메이션 효과 --- */
            @keyframes bounce {
                0%,
                20%,
                50%,
                80%,
                100% {
                    transform: translateY(0);
                }
                40% {
                    transform: translateY(-40px);
                }
                60% {
                    transform: translateY(-20px);
                }
            }

            .header {
                margin-bottom: 30px;
            }

            .title {
                font-family: var(--font-pixel);
                font-size: 2.5em;
                color: var(--color-primary);
                text-shadow: 3px 3px 0 #fff, 6px 6px 0 rgba(0, 0, 0, 0.2);
                animation: float 3s ease-in-out infinite;
            }

            /* 떠다니는 애니메이션 */
            @keyframes float {
                0%,
                100% {
                    transform: translateY(0);
                }
                50% {
                    transform: translateY(-10px);
                }
            }

            .search-container {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 10px;
                margin-bottom: 30px;
            }
            #pokeId {
                padding: 10px;
                border-radius: 8px;
                border: 2px solid #fff;
                font-size: 16px;
                height: 24px;
                width: 150px;
                text-align: center;
            }
            #pokeBtn {
                font-family: var(--font-pixel);
                font-size: 14px;
                padding: 12px 20px;
                border-radius: 8px;
                border: none;
                background-color: var(--color-primary);
                color: white;
                cursor: pointer;
                transition: all 0.3s;
                box-shadow: 0 4px 0 var(--color-primary-dark);
            }
            #pokeBtn:hover {
                background-color: var(--color-primary-dark);
                transform: translateY(2px);
                box-shadow: 0 2px 0 var(--color-primary-dark);
            }

            /* 로딩 스피너 스타일 */
            .loader {
                border: 8px solid #f3f3f3;
                border-top: 8px solid var(--color-primary);
                border-radius: 50%;
                width: 60px;
                height: 60px;
                animation: spin 1s linear infinite;
                margin: 30px auto;
                display: none; /* 평소엔 숨김 */
            }
            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            /* 포켓몬 정보 카드 스타일 */
            #pokeBox {
                display: inline-block;
                background: var(--color-card);
                backdrop-filter: blur(10px); /* 유리 같은 효과 */
                border-radius: 20px;
                padding: 30px;
                box-shadow: var(--shadow);
                border: 1px solid rgba(255, 255, 255, 0.18);
                max-width: 320px;
                width: 100%;
                box-sizing: border-box;
                opacity: 0;
                transform: scale(0.9);
                transition: opacity 0.8s, transform 0.8s;
            }
            #pokeBox.visible {
                opacity: 1;
                transform: scale(1);
            }
            #pokeBox h3 {
                margin: 0 0 5px 0;
                font-size: 32px;
                color: #333;
            }
            #pokeBox h5 {
                margin: 0 0 20px 0;
                font-size: 18px;
                color: #555;
                font-weight: normal;
            }
            #pokeBox img {
                width: 180px;
                height: 180px;
                margin-bottom: 20px;
                cursor: pointer;
                transition: transform 0.5s ease-in-out;
                filter: drop-shadow(0px 8px 8px rgba(0, 0, 0, 0.2));
            }
            #pokeBox img:hover {
                transform: scale(1.15) rotate(5deg);
            }

            /* 타입 태그 스타일 */
            .types-container {
                font-family: 'MemomentKkukkukk', 'Arial', sans-serif;
                display: flex;
                justify-content: center;
                gap: 10px;
                margin-bottom: 20px;
            }
            .type-tag {
                padding: 6px 14px;
                border-radius: 15px;
                color: white;
                font-size: 14px;
                font-weight: bold;
                text-transform: uppercase;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
                text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            }
        </style>
    </head>
    <body>
        <div id="startScreen">
            <img
                src="https://upload.wikimedia.org/wikipedia/commons/5/53/Pok%C3%A9_Ball_icon.svg"
                alt="Poké Ball"
                id="pokeball"
            />
        </div>

        <div id="mainContent" style="display: none">
            <header class="header">
                <h1 class="title">Pokédex</h1>
            </header>
            <section>
                <div class="search-container">
                    <span>No.</span>
                    <input id="pokeId" type="number" min="1" />
                    <button id="pokeBtn">Search</button>
                </div>
            </section>
            <div class="loader" id="loader"></div>
            <section id="pokeBox"></section>
        </div>

        <script>
            // 시작 화면 로직
            document.addEventListener("DOMContentLoaded", () => {
                const startScreen = document.getElementById("startScreen");
                const mainContent = document.getElementById("mainContent");

                // 2.5초 후에 시작 화면을 숨기고 메인 콘텐츠를 표시
                setTimeout(() => {
                    startScreen.classList.add("hidden");

                    // 사라지는 애니메이션이 끝난 후 완전히 제거
                    startScreen.addEventListener("transitionend", () => {
                        startScreen.style.display = "none";
                        mainContent.style.display = "block";

                        // 이전에 검색한 포켓몬 데이터 불러오기
                        const rawRecentPoke = localStorage.getItem("recent");
                        if (rawRecentPoke) {
                            renderPoke(JSON.parse(rawRecentPoke));
                        }
                    });
                }, 2500); // 2.5초 동안 시작 화면 표시
            });

            // --- 기존 포켓몬 도감 로직 ---
            const pokeBtn = document.querySelector("#pokeBtn");
            const pokeIdInput = document.querySelector("#pokeId");
            const pokeBox = document.querySelector("#pokeBox");
            const loader = document.querySelector("#loader");

            // 타입-이모지 매핑
            const typeEmojis = {
                grass: "🌿",
                fire: "🔥",
                water: "💧",
                bug: "🐛",
                normal: "⭐",
                poison: "☠️",
                electric: "⚡",
                ground: "🌍",
                fairy: "🧚",
                fighting: "🥊",
                psychic: "🔮",
                rock: "🗿",
                ghost: "👻",
                ice: "❄️",
                dragon: "🐉",
                steel: "🛡️",
                dark: "🌙",
                flying: "🕊️",
            };

            // API 데이터 호출 함수
            async function getPokemon(id) {
                if (!id) {
                    alert("포켓몬 No.를 입력해주세요.");
                    return;
                }

                loader.style.display = "block";
                pokeBox.classList.remove("visible");

                try {
                    const [pokemonRes, speciesRes] = await Promise.all([
                        fetch(`https://pokeapi.co/api/v2/pokemon/${id}`),
                        fetch(`https://pokeapi.co/api/v2/pokemon-species/${id}`),
                    ]);

                    if (!pokemonRes.ok || !speciesRes.ok) {
                        throw new Error("해당 No.의 포켓몬을 찾을 수 없습니다.");
                    }

                    const data = await pokemonRes.json();
                    const data2 = await speciesRes.json();

                    const koNameObject = data2.names.find(
                        (v) => v.language.name === "ko"
                    );
                    const koName = koNameObject ? koNameObject.name : data.name;

                    const types = data.types.map((item) => item.type.name);

                    const pokeData = {
                        engName: data.name,
                        koName,
                        shape: data.sprites.front_default,
                        sound: data.cries.latest,
                        types,
                    };

                    renderPoke(pokeData);
                    localStorage.setItem("recent", JSON.stringify(pokeData));
                } catch (error) {
                    alert(error.message);
                    pokeBox.innerHTML = ""; // 에러 시 카드 내용 비우기
                } finally {
                    loader.style.display = "none";
                }
            }

            // 이벤트 리스너 설정
            pokeBtn.addEventListener("click", () =>
                getPokemon(pokeIdInput.value)
            );
            pokeIdInput.addEventListener("keyup", (event) => {
                if (event.key === "Enter") getPokemon(pokeIdInput.value);
            });

            // 데이터 화면에 그리기 함수
            function renderPoke({
                engName,
                koName,
                types = [],
                shape,
                sound,
            }) {
                const typeHtml = types
                    .map(
                        (type) => `
                    <span class="type-tag" style="background-color: var(--type-${type})">
                        ${typeEmojis[type] || "❔"} ${type}
                    </span>
                `
                    )
                    .join("");

                pokeBox.innerHTML = `
                    <h3>${koName}</h3>
                    <h5>${engName}</h5>
                    <div class="types-container">${typeHtml}</div>
                    <img id="pokeImg" src="${shape}" alt="${koName}">
                    <audio id="pokeSound" src="${sound}"></audio>
                `;

                pokeBox.classList.add("visible");

                const pokeImg = document.querySelector("#pokeImg");
                const pokeSound = document.querySelector("#pokeSound");
                if (pokeImg && pokeSound) {
                    pokeImg.addEventListener("click", () => pokeSound.play());
                }
            }
        </script>
    </body>
</html>